#!/bin/bash

THIS=$(readlink -f $0)
HERE=$(dirname $THIS)

clear

TMUX=override

echo -e "\n\e[1m\e[4m\e[32mSourcing .bashrc\e[0m"
. $HERE/.bashrc
echo done

em "Updating and upgrading"
sudo apt update
sudo apt upgrade

em "Installing APT packages"
sudo apt install -y $(<$HERE/apt_packages.txt)

function addline () {
    # Add line to file only if it does not already exist
    FILE=$1
    LINE=${@:2}
    grep -qF -- "$LINE" "$FILE" || echo "$LINE" >> "$FILE"
}

em "Setting up environment"
addline "$HOME/.bashrc" ". $HERE/.bashrc"
addline "$HOME/.tmux.conf" "source-file $HERE/.tmux.conf"
echo done

em "Sourcing .bashrc again"
. $HERE/.bashrc
